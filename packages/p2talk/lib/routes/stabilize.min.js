"use strict";const interval=require("../interval"),stabilize=function(e){if(!e)throw new Error("Peer is missing.");return(s,r)=>{e.remote(e.successor).run("predecessor",(s,t)=>{if(s)return e.fixSuccessor(),r.sendStatus(500);t&&interval({left:e.self.id,right:e.successor.id,type:"open"}).contains(t.id)&&e.setSuccessor({host:t.host,port:t.port}),e.remote(e.successor).run("notify",e.self,s=>{if(s)return e.fixSuccessor(),r.sendStatus(500);r.sendStatus(200)})})}};module.exports=stabilize;