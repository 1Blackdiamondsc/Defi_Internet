var request=require("request"),fs=require("fs"),Promise=require("bluebird"),path=require("path"),_=require("underscore"),qs=require("querystring");const Joi=require("@hapi/joi"),Lab=require("lab"),lab=exports.lab=Lab.script();var clusterpost=require("clusterpost-lib"),clustermodel=require("clusterpost-model"),prompt=require("prompt");configfile="./conf.test.execution.json",lab.experiment("Test clusterpost",function(){lab.test("returns true when clusterpost starts as regular user",function(){return clusterpost.start(configfile).then(function(e){return!0})}),lab.test("returns true if tokens are not fetch as regular user",function(){return clusterpost.getExecutionServerToken().then(function(e){Joi.assert(e.statusCode,403)})}),lab.test("returns true if token is fetch as admin user",function(){return clusterpost.promptUsernamePassword().then(function(e){return clusterpost.userLogin(e)}).then(function(){return new Promise(function(e,r){schema={properties:{executionserver:{message:"Type the name of the execution server in the hapi configuration",required:!0}}},prompt.start(),prompt.get(schema,function(t,s){t?r(t):e(s)})})}).then(function(e){return clusterpost.getExecutionServerToken(e)}).then(function(e){Joi.assert(e,Joi.array().items(clustermodel.executionservertoken))})})});