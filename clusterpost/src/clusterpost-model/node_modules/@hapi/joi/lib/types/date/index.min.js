"use strict";const Hoek=require("@hapi/hoek"),Any=require("../any"),Ref=require("../../ref"),internals={isoDate:/^(?:[-+]\d{2})?(?:\d{4}(?!\d{2}\b))(?:(-?)(?:(?:0[1-9]|1[0-2])(?:\1(?:[12]\d|0[1-9]|3[01]))?|W(?:[0-4]\d|5[0-2])(?:-?[1-7])?|(?:00[1-9]|0[1-9]\d|[12]\d{2}|3(?:[0-5]\d|6[1-6])))(?![T]$|[T][\d]+Z$)(?:[T\s](?:(?:(?:[01]\d|2[0-3])(?:(:?)[0-5]\d)?|24\:?00)(?:[.,]\d+(?!:))?)(?:\2[0-5]\d(?:[.,]\d+)?)?(?:[Z]|(?:[+-])(?:[01]\d|2[0-3])(?::?[0-5]\d)?)?)?)?$/};internals.invalidDate=new Date(""),internals.isIsoDate=(()=>{const e=internals.isoDate.toString();return t=>t&&t.toString()===e})(),internals.Date=class extends Any{constructor(){super(),this._type="date"}_base(e,t,s){const a={value:s.convert&&internals.Date.toDate(e,this._flags.format,this._flags.timestamp,this._flags.multiplier)||e};if(a.value instanceof Date&&!isNaN(a.value.getTime()))a.errors=null;else if(s.convert){let r;r=internals.isIsoDate(this._flags.format)?"isoDate":this._flags.timestamp?`timestamp.${this._flags.timestamp}`:"base",a.errors=this.createError(`date.${r}`,{value:e},t,s)}else a.errors=this.createError("date.strict",{value:e},t,s);return a}static toDate(e,t,s,a){if(e instanceof Date)return e;if("string"==typeof e||"number"==typeof e&&!isNaN(e)&&isFinite(e)){const r=t&&internals.isIsoDate(t);let n;if(!r&&"string"==typeof e&&/^[+-]?\d+(\.\d+)?$/.test(e)&&(e=parseFloat(e)),n=r?t.test(e)?new Date(e.toString()):internals.invalidDate:s?/^\s*$/.test(e)?internals.invalidDate:new Date(e*a):new Date(e),!isNaN(n.getTime()))return n}return null}iso(){if(this._flags.format===internals.isoDate)return this;const e=this.clone();return e._flags.format=internals.isoDate,e}timestamp(e="javascript"){const t=["javascript","unix"];if(Hoek.assert(t.includes(e),'"type" must be one of "'+t.join('", "')+'"'),this._flags.timestamp===e)return this;const s=this.clone();return s._flags.timestamp=e,s._flags.multiplier="unix"===e?1e3:1,s}_isIsoDate(e){return internals.isoDate.test(e)}},internals.compare=function(e,t){return function(s){const a="now"===s,r=Ref.isRef(s);return a||r||(s=internals.Date.toDate(s)),Hoek.assert(s,"Invalid date format"),this._test(e,s,function(n,i,o){let l;if(a)l=Date.now();else if(r){const e=s(i.reference||i.parent,o);if(!(l=internals.Date.toDate(e)))return this.createError("date.ref",{ref:s,value:e},i,o);l=l.getTime()}else l=s.getTime();return t(n.getTime(),l)?n:this.createError("date."+e,{limit:new Date(l),value:n},i,o)})}},internals.Date.prototype.min=internals.compare("min",(e,t)=>e>=t),internals.Date.prototype.max=internals.compare("max",(e,t)=>e<=t),internals.Date.prototype.greater=internals.compare("greater",(e,t)=>e>t),internals.Date.prototype.less=internals.compare("less",(e,t)=>e<t),module.exports=new internals.Date;