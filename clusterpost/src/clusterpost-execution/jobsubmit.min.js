var _=require("underscore");module.exports=function(t,e,u){var s=require("./executionserver.methods")(u),r=require("./"+u.engine)(u),a=s.createDirectoryCWD(t);const n=function(t){return s.getAllDocumentInputs(t,a).bind({}).then(function(e){this.downloadstatus=e;for(var u=!0,s=0;s<e.length;s++)e[s].status||(u=!1);return u?r.submitJob(t,a).catch(function(t){return t}):{status:"DOWNLOADING",error:"Unable to retrieve all the input data"}}).then(function(e){return t.jobstatus=e,sudboc.timestampstart=new Date,_.extend(t.jobstatus,this),s.uploadDocumentDataProvider(t)})};return"CREATE"===t.jobstatus.status||"QUEUE"===t.jobstatus.status||"DOWNLOADING"===t.jobstatus.status?n(t):r.getJobStatus(t).then(function(u){return"RUN"!==u.status&&e?(t.jobstatus.uploadstatus&&delete t.jobstatus.uploadstatus,n(t)):(t.jobstatus=u,s.uploadDocumentDataProvider(t))}).catch(function(t){return t})};